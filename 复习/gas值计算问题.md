Solidity Gas费用计算练习题
题目1：基础交易Gas计算
场景：
EOA向合约地址调用update()函数修改状态变量，参数为字符串"new message"  
已知：

基础交易Gas：21,000  SSTORE新值（非零→非零）：5,000字符串操作Gas：1,000（估算值）事件日志Gas：1,750（含1个topic和32字节数据）Gas单价：15 Gwei
问题：

计算总Gas消耗若Gas Limit设为50,000，实际消耗Gas是多少？剩余Gas如何处理？
解答：

总Gas = 基础Gas + 存储Gas + 操作Gas + 事件Gas
= 21,000 + 5,000 + 1,000 + 1,750 = 28,750 Gas实际消耗28,750 Gas，剩余50,000 - 28,750 = 21,250 Gas会全额退款给调用者
（因为EIP-3529后，只有存储清零的Gas会部分退款）
选择理由：
覆盖基础交易结构+状态修改+事件日志的完整Gas计算场景

题目2：存储清零的Gas退款
合约代码：
pragma solidity ^0.8.0;
contract StorageDemo {
    uint256 public value = 100; // 初始值100
    
    function clearValue() public {
        value = 0; // 清零操作
    }
}

已知：

SSTORE清零退款：4,800（EIP-3529后）其他Gas消耗：基础21,000 + 操作500
问题：

计算净Gas消耗（考虑退款后）解释为什么清零操作有退款
解答：

总消耗 = 21,000 + 5,000(SSTORE) + 500 = 26,500 Gas
净消耗 = 26,500 - 4,800 = 21,700 Gas清零退款机制鼓励释放存储空间，减轻区块链状态膨胀问题
选择理由：
展示EIP-3529后的退款机制变化

题目3：合约创建Gas计算
场景：
部署包含以下构造函数的合约：
constructor() {
    owner = msg.sender; // 地址存储
    counter = 1;        // 数值存储
}

已知：

合约创建基础Gas：32,000SSTORE新值（零→非零）：22,100（含动态定价）地址存储额外Gas：2,500
问题：

计算部署合约的总Gas成本比较与普通交易Gas的差异
解答：

总Gas = 32,000 + 22,100 + 2,500 = 56,600 Gas比普通交易高约2.7倍，主要因为：

需要存储合约字节码初始化多个状态变量

选择理由：
突出合约创建的特殊性及状态初始化成本

题目4：Gas Limit不足场景
合约代码：
function batchUpdate(uint[] calldata values) public {
    for(uint i=0; i<values.length; i++) {
        data[i] = values[i]; // 每个SSTORE消耗5,000 Gas
    }
}

参数：
values数组长度为10，Gas Limit设为50,000
问题：

计算实际需要的Gas交易会成功吗？失败后如何处理？
解答：

需要Gas = 21,000 + (10×5,000) = 71,000 Gas交易会失败并：

所有状态修改回滚已消耗的Gas（达到50,000前执行的步骤）不退款

选择理由：
演示Gas不足导致的"Out of Gas"错误及后果

题目设计原则说明

渐进复杂度：
从基础交易→状态修改→合约创建→复杂操作逐步提升难度
关键概念覆盖：

基础交易成本（21,000 Gas）  存储操作动态定价（SSTORE）EIP-3529后的退款规则合约创建特殊成本Gas Limit的实际影响
实用场景：
选择真实开发中常见的操作（如状态更新、事件记录、批量处理等）
版本特性：
突出Post-London升级后的Gas机制变化，避免过时的计算方式

建议在Remix IDE中实际运行这些场景，观察Gas消耗与理论计算的差异，加深理解。
